---
import type { CollectionEntry } from "astro:content";

import { getCollection, getEntry, render } from "astro:content";

import HeroNote from "@components/HeroNote.astro";
import LayoutContainer from "@components/LayoutContainer.astro";
import NotesContent from "@components/NotesContent.astro";
import TextPage from "@components/TextPage.astro";

import Layout from "@layouts/Layout.astro";

import "@styles/content.css";

import formatDate from "@utils/format-date";

export async function getStaticPaths() {
  const allNotes = await getCollection("notes");

  const allNotesSlugs = allNotes.map((note: CollectionEntry<"notes">) => {
    return { params: { slug: note.id }, props: { note } };
  });

  return allNotesSlugs;
}

const { note } = Astro.props as { note: CollectionEntry<"notes"> };

const dateFormatted = formatDate(note.data.dateNote);

const entry = await getEntry("notes", note.id);

if (!entry) {
  throw new Error(`Could not find note ${note.id}`);
}

const { Content } = await render(entry);
---

<Layout title={note.data.title}>
  <LayoutContainer class="layout-notes">
    <HeroNote
      date={note.data.dateNote}
      dateFormatted={dateFormatted}
      title={note.data.title}
    />
    <NotesContent>
      <Content
        components={{
          p: TextPage,
        }}
      />
    </NotesContent>
  </LayoutContainer>
</Layout>

<style lang="scss">
  .layout-notes {
    @include container-desktop {
      padding-inline: 16px;
    }
  }
</style>
